#include "fir.h"

static double filter_taps[TAP_NUM] = {
		  -0.0013123772378676047,
		  -0.0031605599015712776,
		  -0.005986591567062689,
		  -0.009159556831822398,
		  -0.01154041419452204,
		  -0.011481411833008551,
		  -0.007141986330698758,
		  0.003013161639038818,
		  0.0196552676785879,
		  0.04214834716686726,
		  0.06838648110954758,
		  0.09501798740107799,
		  0.11804981608062422,
		  0.13369228681725182,
		  0.13923477656483832,
		  0.13369228681725182,
		  0.11804981608062422,
		  0.09501798740107799,
		  0.06838648110954758,
		  0.04214834716686726,
		  0.0196552676785879,
		  0.003013161639038818,
		  -0.007141986330698758,
		  -0.011481411833008551,
		  -0.01154041419452204,
		  -0.009159556831822398,
		  -0.005986591567062689,
		  -0.0031605599015712776,
		  -0.0013123772378676047
};

void FirInit(FirFilter* f) {
  int i;
  for(i = 0; i < TAP_NUM; ++i)
    f->history[i] = 0;
}

unsigned short FirPut(FirFilter* f, unsigned short input) {
	double acc = 0;

  for(int i = TAP_NUM - 1; i > 0; i--) {
	f->history[i] = f->history[i-1];
    acc += f->history[i] * filter_taps[i];
  };
  f->history[0] = input;
  acc += input*filter_taps[0];
  return (unsigned short)acc;
}
